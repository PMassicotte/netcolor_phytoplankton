---
title: "Seasonal and decadal variability in bio-optical properties in the Northwest Atlantic"
# subtitle: "Mentoring opportunity"
author: 
  - "Philippe Massicotte"
date: '2022-01-21 (updated on: `r Sys.Date()`)'
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    nature:
      slideNumberFormat: "%current%"
      highlightStyle: github
      highlightLines: true
      ratio: 16:9
      countIncrementalSlides: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  fig.width = 5, 
  fig.height = 3.5,
  fig.align = "center",
  dev = "svg",
  cache = TRUE,
  echo = FALSE,
  message = FALSE, 
  warning = FALSE
)

library(tidyverse)
library(ggpmthemes)
library(here)
library(showtext)
library(patchwork)

theme_set(theme_minimal(base_family = "Roboto"))

theme_update(
  panel.border = element_blank(),
  axis.ticks = element_blank()
)

source(here("R","zzz.R"))

# install.packages("remotes")
# remotes::install_github("gadenbuie/xaringanthemer")
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_accent(
  base_color = "#203240",
  header_font_google = google_font("Patrick Hand"),
  text_font_google = google_font("Montserrat", "500", "500i"),
  code_font_google = google_font("Fira Mono"),
  text_font_size = "24px",
  base_font_size = "20px",
  text_color = "#d6bf61",
  background_color = "#203240",
  header_color = "#b25a56", 
  title_slide_text_color = "#d6bf61",
  text_bold_color = "#b25a56",
  text_bold_font_weight = 600, 
  inverse_background_color = "#232323"
)
```

```{css, echo=FALSE}
a {
  color: deepskyblue;
}

.column-left {
  width: 60%;
  float: left;
  padding-top: 1em;
  margin-right: 0em;
}

.column-right {
  width: 40%;
  float: right;
  padding-top: 0em;
}

.inverse h1{
	color: var(--inverse-header-color);
	font-size: 80px;
	/* font-size: "40em"; */
}

.inverse h2{
	color: var(--inverse-header-color);
	font-size: 70px;
	/* font-size: "40em"; */
}
```

## Motivations (1/2)

- A rich literature has used optical indices used to study the spatial and seasonal response of phytoplankton communities to the **underwater lightscape**:

--

  - Positive relationships between ** $a_{\phi}$ ** and **chlorophyll-*a*** extensively documented (phytoplankton biomass).

--

  - ** $a_{\phi}^*$ ** vary due to changes in phytoplankton intracellular composition and pigment packaging effect (**used to determine phytoplankton size classes and taxonomic groups**).

<br>

--

`r fontawesome::fa("exclamation-circle", fill = "#EFCA08")` Long-time series at high spatial resolution are difficult to acquire due to financial and logistical constraints (**often limited around the algal spring bloom**).

---

## Motivations (2/3)

Phytoplankton absorption at 440 nm and  675 nm is useful to study the phytoplankton dynamics in several aquatic ecosystems:

```{r, out.width="45%"}
df <- read_csv(here("data", "clean", "absorption.csv")) %>% 
  filter(sample_id == 439195)

df_peaks <- df %>% 
  filter(wavelength %in% c(440, 675))

df %>%
  ggplot(aes(x = wavelength, y = aphy)) +
  geom_line() +
  geom_point(data = df_peaks, size = 5, color = "red") +
  labs(
    x = "Wavelength (nm)",
    y = quote(a[phi]~(lambda)~(m^{-1}))
  )
```

--

**Do not fully exploit the spectral information contained in absorption measurements.**

---

## Motivations (3/3)

- Phytoplankton absorption is becoming routinely measured by *in situ* by autonomous profilers and **the emergence of hyperspectral satellites**.

- There is a need to develop new indices **to syntheses all the information contained in a phytoplankton absorption spectrum**.

```{r}
# https://doi.pangaea.de/10.1594/PANGAEA.915747?format=html#download

df <- read_table(
  "https://store.pangaea.de/Publications/Craig-etal_2020/HL_Rrs_sun10_.txt",
  skip = 25,
  col_names = TRUE
) %>%
  rowid_to_column() %>% 
  pivot_longer(
    -rowid,
    names_to = "wavelength",
    values_to = "rrs",
    names_transform = list(wavelength = parse_number)
  ) %>% 
  drop_na()

df %>% 
  ggplot(aes(x = wavelength, y = rrs, group = rowid)) +
  geom_line(size = 0.1) +
  labs(
    x = "Wavelength (nm)",
    y = quote("Rrs"~(sr^{-1}))
  )
```

---

class: inverse, center, middle

## Two objectives

### 1. Explore the seasonal variability of the phytoplankton in the Northwest Atlantic

### 2. Evaluate the ability of a **new spectral index** to get insights of the phytoplankton dynamics

---

## The sampling

.pull-left[
- **20 years of data** to provide a detailed picture of the seasonal and the decadal variability bio-optical indices in Northwest Atlantic.

<br>

- More than **3200 observations** of pigments, chlorophyll-*a* and absorption measurements.

<br>

- **Three bioregions** sampled in autumn, summer, spring and winter.

]

.pull-right[
```{r, out.width="90%"}
knitr::include_graphics(pdf2png(here("graphs","appendix01.pdf")))
```
]

---

## The bioregions of the Northwest Atlantic

```{r, out.width="55%"}
knitr::include_graphics(pdf2png(here("graphs","fig01.pdf")))
```

---

## Chlorophyll-*a* vs $a_{\phi}$

Agreement with previously reported models in coastal and marine environments.

```{r, out.width="40%"}
knitr::include_graphics(pdf2png(here("graphs","fig04.pdf")))
```

---

## Packaging effect

The negative relation between this ratio and chlorophyll-*a* is an **indication of packaging effect and changes in the intercellular composition of pigments**.

```{r, out.width="90%"}
knitr::include_graphics(pdf2png(here("graphs","fig05.pdf")))
```

---

## Packaging effect (seasonal variability)

- Indications that the cell size of the phytoplankton is significantly higher in the summer compared to the winter:

  - **acclimating to increasing solar irradiance by reducing intracellular chlorophyll-*a* content and increasing carotenoid content**

```{r, out.width="80%"}
knitr::include_graphics(pdf2png(here("graphs","appendix04.pdf")))
```

---

class: inverse, center, middle

## The phytoplankton apparent absorption wavelength (PAAW)

---

## Phytoplankton apparent absorption wavelength (PAAW)

Weighted harmonic mean to **enables equal weighting of the wavelengths in the calculation**.

\begin{equation}
\text{PAAW} = \frac{\sum\limits_{i=\lambda_1}^{\lambda_n} a_\phi(\lambda_i)}{\sum\limits_{i=\lambda_1}^{\lambda_n} \frac{a_\phi(\lambda_i)}{\lambda_i}}
\end{equation}

In units of nanometres, simply **represents the wavelength balance point around which absorption is evenly distributed**.

---

## Phytoplankton apparent absorption wavelength (PAAW)

Results suggest that **PAAW is a better proxy** to predict pigments compared to just using a single wavelength (fucoxanthin is a proxy often used to estimate diatoms biomass).

```{r, out.width="70%", fig.width=8}
paaw <- read_csv(here("data/clean/apparent_visible_wavelength.csv"))

df <- read_csv(here("data/clean/merged_dataset.csv")) %>% 
  filter(wavelength == 440)

df <- df %>% 
  inner_join(paaw, by = c("sample_id", "bioregion_name"))

p1 <- df %>% 
  filter(fucox > 0) %>% 
  ggplot(aes(x = avw_aphy, y = fucox)) +
  geom_point(size = 0.5) +
  scale_y_log10() +
  annotation_logticks(sides = "l", size = 0.25) +
  geom_smooth(method = "lm") +
  ggpmisc::stat_poly_eq(
    aes(label = ..eq.label..),
    parse = TRUE,
    coef.digits = 4,
    f.digits = 5,
    p.digits = 10,
    label.x.npc = 0.05,
    family = "Montserrat",
    size = 2.5
  ) +
  ggpmisc::stat_poly_eq(
    label.x.npc = 0.05,
    label.y.npc = 0.88,
    aes(label = ..rr.label..),
    size = 2.5,
    family = "Montserrat"
  ) +
  labs(
    x = "PAAW (nm)",
    y = quote(Fucoxanthin ~ (mg ~ m^{-3}))
  )

p2 <- df %>% 
  filter(fucox > 0) %>% 
  ggplot(aes(x = aphy, y = fucox)) +
  geom_point(size = 0.5) +
  scale_x_log10() +
  scale_y_log10() +
  annotation_logticks(sides = "l", size = 0.25) +
  geom_smooth(method = "lm") +
  ggpmisc::stat_poly_eq(
    aes(label = ..eq.label..),
    parse = TRUE,
    coef.digits = 4,
    f.digits = 5,
    p.digits = 10,
    label.x.npc = 0.05,
    family = "Montserrat",
    size = 2.5
  ) +
  ggpmisc::stat_poly_eq(
    label.x.npc = 0.05,
    label.y.npc = 0.88,
    aes(label = ..rr.label..),
    size = 2.5,
    family = "Montserrat"
  ) +
  labs(
    x = quote(aphy(440)),
    y = quote(Fucoxanthin ~ (mg ~ m^{-3}))
  )

p1 + p2
```
---

## Phytoplankton apparent absorption wavelength (PAAW)

```{r, out.width="45%"}
knitr::include_graphics(pdf2png(here("graphs","fig08.pdf")))
```

---

## Decadal variability (last 20 years)

.left-column[

- **Spring**: shift toward the <font color="#F93943">red part of the spectrum</font>. 

- **Autumn**: shift toward the <font color="#7EB2DD">blue part of the spectrum</font>.

]

.right-column[
```{r, out.width="80%"}
knitr::include_graphics(pdf2png(here("graphs","fig10.pdf")))
```
]
